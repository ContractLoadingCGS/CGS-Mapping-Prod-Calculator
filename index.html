<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="prod-icon.png"> 
  <title>CGS Mapping Prod Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f4f4f4;
      text-align: center;
    }
    .content-container {
      width: 70%;
      max-width: 700px;
      margin: 0 auto;
    }
    #topInputs, #resultsRow {
      display: flex;
      gap: 2rem;
      justify-content: center;
      margin-bottom: 1.5rem;
      max-width: 700px;
      width: 100%;
      margin-left: auto;
      margin-right: auto;
    }
    #topInputs > div, #resultsRow > div {
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 200px;
    }
    label {
      font-weight: 600;
      font-size: 1rem;
      margin-bottom: 6px;
      color: #333;
      user-select: none;
      text-align: center;
    }
    input, textarea {
      width: 100%;
      padding: 8px 12px;
      font-size: 1rem;
      text-align: center;
      border: 2px solid #4CAF50;
      border-radius: 6px;
      box-sizing: border-box;
      background-color: #fff;
      color: #333;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
      outline-offset: 2px;
      outline-color: transparent;
      resize: vertical;
      font-family: inherit;
    }
    input:focus, textarea:focus {
      border-color: #45a049;
      box-shadow: 0 0 6px rgba(69, 160, 73, 0.6);
      outline-color: transparent;
    }
    #conditionalResultInput {
      color: #007BFF;
      font-size: 1.1rem;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      background-color: #fff;
      margin-bottom: 1.5rem;
    }
    th, td {
      border: 1px solid #ddd;
      text-align: center;
      vertical-align: middle;
      font-size: 12px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    th {
      padding: 10px;
      background-color: #4CAF50;
      color: white;
      font-weight: bold;
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    tr:hover {
      background-color: #e0f7fa;
    }
    td input[type="text"] {
      width: 50px !important;
      padding: 4px 6px;
      font-size: 1rem;
      border: 2px solid #4CAF50;
      border-radius: 4px;
      text-align: center;
      box-sizing: border-box;
      background-color: #fff;
      color: #333;
      transition: border-color 0.3s ease, box-shadow 0.3s ease;
    }
    td input[type="text"]:focus {
      border-color: #45a049;
      box-shadow: 0 0 6px rgba(69, 160, 73, 0.6);
      outline-color: transparent;
    }
    #remarksContainer {
      width: 630px;
      margin: 1.5rem auto;
      text-align: left;
      background: #fff;
      padding: 12px 14px;
      border: 2px solid #4CAF50;
      border-radius: 6px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }
    #buttonsContainer {
      max-width: 700px;
      margin: 1.5rem auto 0;
      text-align: center;
    }
    button {
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-right: 1rem;
    }
    #checkBtn { background-color: #4CAF50; color: white; }
    #checkBtn:hover { background-color: #45a049; }
    #generateEmailBtn { background-color: #2196F3; color: white; }
    #generateEmailBtn:hover { background-color: #1976d2; }
    #resetBtn { background-color: #f44336; color: white; margin-right: 0; }
    #resetBtn:hover { background-color: #d32f2f; }
    
    /* MODAL STYLES - FIXED IMAGE LOADING */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.6);
      backdrop-filter: blur(3px);
    }
    .modal-content {
      background-color: #fff;
      margin: 10% auto;
      padding: 30px;
      border-radius: 12px;
      width: 90%;
      max-width: 450px;
      text-align: center;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      position: relative;
      animation: modalSlideIn 0.3s ease-out;
    }
    @keyframes modalSlideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .close {
      color: #999;
      position: absolute;
      right: 20px;
      top: 15px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      line-height: 1;
    }
    .close:hover {
      color: #333;
    }
    #prodImage {
      max-width: 200px;
      max-height: 200px;
      width: auto;
      height: auto;
      margin-bottom: 20px;
      border-radius: 8px;
      border: 2px solid #ddd;
      background: #f9f9f9; /* Fallback background */
    }
    #prodImage.error {
      background: #ffebee;
      border-color: #f44336;
    }
    #prodMessage {
      font-size: 1.3rem;
      margin: 0 0 20px 0;
      font-weight: 600;
    }
    
    @media (max-width: 520px) {
      #topInputs, #resultsRow {
        flex-direction: column;
        align-items: center;
      }
      #topInputs > div, #resultsRow > div {
        width: 100%;
        max-width: 280px;
      }
      #buttonsContainer {
        padding: 0 1rem;
      }
      #remarksContainer {
        width: 90%;
        max-width: 400px;
      }
      td input[type="text"] {
        width: 45px !important;
      }
      .modal-content {
        margin: 20% auto;
        width: 95%;
        padding: 25px 20px;
      }
    }
    #mapping-logo {
      height: 80px;
      margin-bottom: -120px;
    }
    .logo-top{
      display:flex;
      margin-bottom: -20px;
    }
    
    /* TEST IMAGES - HIDDEN */
    .test-images {
      position: absolute;
      left: -9999px;
      width: 1px;
      height: 1px;
    }
  </style>
</head>
<body>
<!-- HIDDEN TEST IMAGES - These will show in DevTools if paths work -->
<img src="image1.png" class="test-images" id="testImage1" alt="Test 1">
<img src="image2.png" class="test-images" id="testImage2" alt="Test 2">

<div class="logo-top">
<img id="mapping-logo" src="mapping-logo.png" alt="CGS Xmas Logo" />
</div>

  <h2>CGS Mapping Prod Calculator</h2>
  
  <!-- Top Inputs -->
  <div id="topInputs" class="content-container">
    <div>
      <label for="dateInput">Date</label>
      <input type="date" id="dateInput" />
    </div>
    <div>
      <label for="fname">Full Name</label>
      <input type="text" id="fname" placeholder="Enter your full name" autocomplete="off" />
    </div>
  </div>
  
  <!-- Productivity Table -->
  <div class="content-container">
    <table>
      <thead>
        <tr>
          <th>Request Type</th>
          <th># of Child Cases</th>
          <th>Average Handling Time</th>
          <th>Productivity Hours</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>New Master Estab Creation</td><td><input type="text" data-minutes="25" placeholder="Qty" /></td><td><p>00:25:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Content Update</td><td><input type="text" data-minutes="20" placeholder="Qty" /></td><td><p>00:20:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Linked Supplier</td><td><input type="text" data-minutes="10" placeholder="Qty" /></td><td><p>00:10:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>New Master Room Creation <br><span style="color: rgba(33, 150, 243, 1); display: contents;">(Count of Master Rooms Update)</span></td><td><input type="text" data-minutes="4" data-seconds="11" placeholder="Qty" /></td><td><p>00:04:11</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Linked Supplier Room <br><span style="color: rgba(33, 150, 243, 1); display: contents;">(Count of Supplier Rooms Update)</span></td><td><input type="text" data-minutes="0" data-seconds="30" placeholder="Qty" /></td><td><p>00:00:30</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Room Content Update <br><span style="color: rgba(33, 150, 243, 1); display: contents;">(Count of Master Rooms Update)</span></td><td><input type="text" data-minutes="4" data-seconds="10" placeholder="Qty" /></td><td><p>00:04:10</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Promote to Global</td><td><input type="text" data-minutes="05" placeholder="Qty" /></td><td><p>00:05:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Content Correction</td><td><input type="text" data-minutes="15" placeholder="Qty" /></td><td><p>00:15:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Published Notes</td><td><input type="text" data-minutes="10" placeholder="Qty" /></td><td><p>00:10:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Update Location</td><td><input type="text" data-minutes="10" placeholder="Qty" /></td><td><p>00:10:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Hotel name changed</td><td><input type="text" data-minutes="10" placeholder="Qty" /></td><td><p>00:10:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Disable Estab</td><td><input type="text" data-minutes="07" placeholder="Qty" /></td><td><p>00:07:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Enable Estab</td><td><input type="text" data-minutes="07" placeholder="Qty" /></td><td><p>00:07:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Merge Estab</td><td><input type="text" data-minutes="20" placeholder="Qty" /></td><td><p>00:20:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Extranet Content Moderation</td><td><input type="text" data-minutes="15" placeholder="Qty" /></td><td><p>00:15:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Property Tagging</td><td><input type="text" data-minutes="15" placeholder="Qty" /></td><td><p>00:15:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>New Location</td><td><input type="text" data-minutes="15" placeholder="Qty" /></td><td><p>00:15:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Polygon</td><td><input type="text" data-minutes="30" placeholder="Qty" /></td><td><p>00:30:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Escalation</td><td><input type="text" data-minutes="30" placeholder="Qty" /></td><td><p>00:30:00</p></td><td><span class="handling-time-result"></span></td></tr>
        <tr><td>Adhoc</td><td><input type="text" data-minutes="05" placeholder="Qty" /></td><td><p>00:05:00</p></td><td><span class="handling-time-result"></span></td></tr>
      </tbody>
    </table>
  </div>
   
  <!-- Remarks container -->
  <div id="remarksContainer">
    <label for="remarks">Remarks</label>
    <textarea id="remarks" placeholder="Enter any remarks here..."></textarea>
  </div>
  
  <!-- Divisor, Average Hrs, Average Prod -->
  <div id="resultsRow" class="content-container">
    <div>
      <label for="dayDivisor">Productive Hrs</label>
      <input type="number" id="dayDivisor" min="0.1" step="0.01" value="7.5" placeholder="Enter Prod Hrs:" />
    </div>
    <div>
      <label for="totalResult">Average Hrs</label>
      <input type="text" id="totalResult" readonly placeholder="0.00" />
    </div>
    <div>
      <label for="conditionalResultInput">Average Prod</label>
      <input type="text" id="conditionalResultInput" readonly />
    </div>
  </div>
  
  <!-- Buttons container -->
  <div id="buttonsContainer" class="content-container">
    <button type="button" id="checkBtn">Calculate</button>
    <button type="button" id="generateEmailBtn">Send EOD</button>
    <button type="button" id="resetBtn">Reset</button>
  </div>

  <!-- PRODUCTIVITY MODAL -->
  <div id="prodModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <img id="prodImage" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" alt="Productivity Status">
      <h3 id="prodMessage">Loading...</h3>
    </div>
  </div>

  <script>
    // TEST IMAGE LOADING ON STARTUP
    window.addEventListener('DOMContentLoaded', function() {
      const test1 = document.getElementById('testImage1');
      const test2 = document.getElementById('testImage2');
      
      test1.onload = () => console.log('‚úÖ image1.png LOADS OK');
      test1.onerror = () => console.log('‚ùå image1.png FAILED - Check filename/case/location');
      test2.onload = () => console.log('‚úÖ image2.png LOADS OK');
      test2.onerror = () => console.log('‚ùå image2.png FAILED - Check filename/case/location');
    });

    function formatNumber(num) {
      return Number(num).toFixed(2);
    }

    function saveToStorage() {
      ['dateInput', 'fname', 'remarks', 'dayDivisor'].forEach(id => {
        const element = document.getElementById(id);
        if (element) localStorage.setItem(id, element.value);
      });
      document.querySelectorAll('table tbody input[type="text"]').forEach((input, index) => {
        localStorage.setItem(`qtyInput_${index}`, input.value);
      });
    }

    function restoreFromStorage() {
      ['dateInput', 'fname', 'remarks', 'dayDivisor'].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          const savedValue = localStorage.getItem(id);
          if (savedValue !== null) element.value = savedValue;
        }
      });
      document.querySelectorAll('table tbody input[type="text"]').forEach((input, index) => {
        const savedValue = localStorage.getItem(`qtyInput_${index}`);
        if (savedValue !== null) input.value = savedValue;
      });
    }

    function clearStorage() {
      localStorage.removeItem('dateInput');
      localStorage.removeItem('fname');
      localStorage.removeItem('remarks');
      localStorage.removeItem('dayDivisor');
      document.querySelectorAll('table tbody input[type="text"]').forEach((_, index) => {
        localStorage.removeItem(`qtyInput_${index}`);
      });
    }

    function updateAllHandlingTimes() {
      document.querySelectorAll('table tbody tr').forEach(row => {
        const qtyInput = row.querySelector('input[type="text"]');
        const resultSpan = row.querySelector('.handling-time-result');
        if (qtyInput && resultSpan) {
          const qty = Number(qtyInput.value);
          const minutesPerUnit = Number(qtyInput.getAttribute('data-minutes')) || 0;
          const secondsPerUnit = Number(qtyInput.getAttribute('data-seconds')) || 0;
          if (!isNaN(qty) && qty > 0) {
            const totalSeconds = qty * (minutesPerUnit * 60 + secondsPerUnit);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            resultSpan.textContent = `${hours}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
          } else {
            resultSpan.textContent = '';
          }
        }
      });
    }

    // FIXED MODAL FUNCTIONS WITH IMAGE PATH DEBUGGING
    function showProdModal(averageProd) {
  const modal = document.getElementById('prodModal');
  const prodImage = document.getElementById('prodImage');
  const prodMessage = document.getElementById('prodMessage');

  // üõ°Ô∏è SUPER SAFE: Round to nearest whole number first
  const roundedProd = Math.round(averageProd * 10) / 10; // 1 decimal precision
  console.log('Raw averageProd:', averageProd);
  console.log('Rounded averageProd:', roundedProd);

  prodImage.classList.remove('error');
  prodImage.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';

  if (roundedProd >= 99.50) {
    prodImage.src = 'image1.png';
    prodMessage.textContent = `üéâ Excellent! Average Productivity ‚â• 100%`;
    prodMessage.style.color = '#4CAF50';
  } else {
    prodImage.src = 'image2.png';
    prodMessage.textContent = `üìâ Needs Improvement: ${Math.round(roundedProd)}%`;
    prodMessage.style.color = '#f44336';
  }

  prodImage.onload = () => console.log('‚úÖ IMAGE LOADED');
  prodImage.onerror = () => console.log('‚ùå IMAGE FAILED');
  
  modal.style.display = 'block';

}
    function closeProdModal() {
      document.getElementById('prodModal').style.display = 'none';
    }

    function performCalculation() {
      const dateInput = document.getElementById('dateInput');
      const fnameInput = document.getElementById('fname');
      const totalResultInput = document.getElementById('totalResult');
      const conditionalInput = document.getElementById('conditionalResultInput');
      const divisorInput = document.getElementById('dayDivisor');

      if (!dateInput.value) {
        alert('Please select a date.');
        dateInput.focus();
        return false;
      }
      if (!fnameInput.value.trim()) {
        alert('Please enter your full name.');
        fnameInput.focus();
        return false;
      }
      let divisorVal = parseFloat(divisorInput.value);
      if (isNaN(divisorVal) || divisorVal <= 0) {
        alert('Please enter a valid positive number for Productive Hrs.');
        divisorInput.focus();
        return false;
      }
      const qtyInputs = Array.from(document.querySelectorAll('table tbody input[type="text"]'));
      if (!qtyInputs.some(input => input.value.trim() !== '')) {
        alert('Please enter a value for at least one of the quantities before submitting.');
        return false;
      }

      let totalSeconds = 0;
      qtyInputs.forEach(input => {
        const qty = Number(input.value);
        const minutesPerUnit = Number(input.getAttribute('data-minutes')) || 0;
        const secondsPerUnit = Number(input.getAttribute('data-seconds')) || 0;
        if (!isNaN(qty) && qty > 0) {
          totalSeconds += qty * (minutesPerUnit * 60 + secondsPerUnit);
        }
      });

      const totalHours = totalSeconds / 3600;
      totalResultInput.value = totalHours.toFixed(2);
      const averageProd = (totalHours / divisorVal) * 100;
      conditionalInput.value = Math.round(averageProd) + '%';

      showProdModal(averageProd);
      return true;
    }

    function generateEmailWithPrompt() {
      if (!performCalculation()) return;
      const dateInput = document.getElementById('dateInput');
      const fnameInput = document.getElementById('fname');
      const conditionalInput = document.getElementById('conditionalResultInput');
      const remarksInput = document.getElementById('remarks');
      const divisorInput = document.getElementById('dayDivisor');

      const rawDate = dateInput.value;
      const dateObj = new Date(rawDate);
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      const formattedDate = dateObj.toLocaleDateString(undefined, options);

      let emailBody = `Hi TL,\n\nPlease see below Daily Productivity:\n\n`;
      emailBody += `Date: ${dateInput.value}\n`;
      emailBody += `Full Name: ${fnameInput.value.trim()}\n\n`;
      const remarksText = remarksInput.value.trim();
      if (remarksText) {
        emailBody += `Remarks:\n${remarksText}\n\n`;
      }
      emailBody += `Values:\n`;
      const rows = Array.from(document.querySelectorAll('table tbody tr'));
      rows.forEach(row => {
        const requestType = row.cells[0].innerText.trim();
        const qtyInput = row.querySelector('input[type="text"]');
        if (qtyInput && qtyInput.value.trim() !== '') {
          emailBody += `Request Type;- ${requestType}: = ${qtyInput.value.trim()}\n`;
        }
      });
      emailBody += `\nAverage Productivity: ${conditionalInput.value}`;
      emailBody += `\nProductive Hours: ${divisorInput.value} hrs/mins \n`;
      const subject = encodeURIComponent(`${formattedDate} - EOD - ${fnameInput.value.trim()}`);
      const body = encodeURIComponent(emailBody);
      const mailtoLink = `mailto:?subject=${subject}&body=${body}`;
      if (confirm('Do you want to send the email now?')) {
        window.location.href = mailtoLink;
      }
    }

    function resetForm() {
      document.querySelectorAll('table tbody input[type="text"]').forEach(input => (input.value = ''));
      document.querySelectorAll('.handling-time-result').forEach(span => (span.textContent = ''));
      document.getElementById('dateInput').value = '';
      document.getElementById('fname').value = '';
      document.getElementById('dayDivisor').value = '7.5';
      document.getElementById('remarks').value = '';
      document.getElementById('totalResult').value = '';
      document.getElementById('conditionalResultInput').value = '';
      clearStorage();
      closeProdModal();
    }

    // SETUP EVENT LISTENERS
    window.addEventListener('DOMContentLoaded', () => {
      restoreFromStorage();
      
      const dateInput = document.getElementById('dateInput');
      if (!dateInput.value) {
        const today = new Date();
        const yyyy = today.getFullYear();
        let mm = today.getMonth() + 1;
        let dd = today.getDate();
        if (mm < 10) mm = '0' + mm;
        if (dd < 10) dd = '0' + dd;
        dateInput.value = `${yyyy}-${mm}-${dd}`;
      }

      const allInputs = document.querySelectorAll('input, textarea');
      allInputs.forEach(input => {
        input.addEventListener('input', saveToStorage);
        if (input.matches('table tbody input[type="text"]')) {
          input.addEventListener('input', updateAllHandlingTimes);
        }
      });

      document.getElementById('checkBtn').addEventListener('click', performCalculation);
      document.getElementById('generateEmailBtn').addEventListener('click', generateEmailWithPrompt);
      document.getElementById('resetBtn').addEventListener('click', resetForm);
      
      // MODAL EVENT LISTENERS
      document.querySelector('.close').addEventListener('click', closeProdModal);
      document.getElementById('prodModal').addEventListener('click', function(event) {
        if (event.target === this) closeProdModal();
      });
      
      updateAllHandlingTimes();
    });

    window.addEventListener('beforeunload', saveToStorage);
  </script>
</body>
</html>

